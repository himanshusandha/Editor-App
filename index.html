<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" href="css_index.css">
</head>
<body>
<div id="btn_grp">
  <button class="tablink" onclick="openPage('Frameeg1', this)" onmouseover="closebtndis(this)" onmouseout="closebtnin(this)">new 0.txt
    <span onclick="closePage('Frameeg1',this)" class="closebtn">X</span>
  </button>
  <button class="tablink" onclick="openPage('Frameeg2', this)" onmouseover="closebtndis(this)" onmouseout="closebtnin(this)">index.html
    <span onclick="closePage('Frameeg2',this)" class="closebtn">X</span>
  </button>
  <button class="tablink" onclick="openPage('Frameeg3', this)" onmouseover="closebtndis(this)" onmouseout="closebtnin(this)">new 1.txt
    <span onclick="closePage('Frameeg3',this)" class="closebtn">X</span>
  </button>
  <button class="tablink" onclick="openPage('Frameeg4', this)" onmouseover="closebtndis(this)" onmouseout="closebtnin(this)">index 1.html
    <span onclick="closePage('Frameeg4',this)" class="closebtn">X</span>
  </button>
</div>

<div id="frm_grp">
  <div id="Frameeg1" class="tabcontent">
    <iframe src="coding_area.html"></iframe>
  </div>
  <div id="Frameeg2" class="tabcontent">
    <iframe src="coding_area.html"></iframe>
  </div>
  <div id="Frameeg3" class="tabcontent">
    <iframe src="coding_area.html"></iframe>
  </div>
  <div id="Frameeg4" class="tabcontent">
    <iframe src="coding_area.html"></iframe>
  </div>
</div>

<!--<div class="footer">

    <div>name file</div>
    <div>total lines:lengthofchars</div>
    <div>current line:column name</div>
    <div>encoding</div>
    <div>Fileformat</div>
</div>-->

<div id="dir_tree" style="margin-top:-700px;">
  <ul id="mainDirectoryUL">
    <li id="mainDirectoryLi">Name</li>
  </ul>
</div>

<script src="close.js"></script>
<script src="open.js"></script>
<script src="general_script_index.js"></script>
<script>
const {ipcRenderer,ipcMain}=require('electron');

//mainDir fun
ipcRenderer.on('mainDir', function(event,args){
  document.getElementById('mainDirectoryLi').setAttribute("data-path",args);
  document.getElementById('mainDirectoryLi').setAttribute("data-is-dir","true");
  document.getElementById('mainDirectoryLi').setAttribute("onclick","open_file_dir(event)");
  let name_split = args.toString().split("\\"); //used .toString() to convert args to a string as it was giving TypeError
  document.getElementById('mainDirectoryLi').textContent = name_split[(name_split.length)-1];
  document.getElementById('mainDirectoryLi').click();
});

//appendUL fun
ipcRenderer.on('appendUL', function(event,args){
  let ulElement = document.createElement('UL');
  for ( i = 1; i <= args[0]; i++) { //i=0 because at 0 index lentgh is stored
    let liElement = document.createElement('LI');
    liElement.setAttribute("data-path", args[i]);
    liElement.setAttribute("data-is-dir", args[args[0]+i]);
    liElement.setAttribute("onclick", "open_file_dir(event)");
    let name_split = args[i].toString().split("\\"); //used .toString() to convert args to a string as it was giving TypeError
    liElement.textContent = name_split[(name_split.length)-1];
    ulElement.appendChild(liElement);
  }
  let li_element_list = document.getElementById('mainDirectoryUL').getElementsByTagName('li');
  for (i = 0; i < li_element_list.length; i++) {
    if (li_element_list[i].getAttribute('data-path') == args[args[0]+args[0]+1]) {
      li_element_list[i].appendChild(ulElement);
      break;
    }
  }
});

//open_file_dir
function open_file_dir(event){
  if(event.target.getAttribute("data-is-dir") == "true"){
    if (event.target.childElementCount == 0) {
      ipcRenderer.send('readDirFunc',event.target.getAttribute("data-path"));
    }
    else {
      event.target.children[0].remove();
    }
  }
  else{

  }
  event.stopPropagation();
}

//newFile
ipcRenderer.on('newFile', function(event,args){
  //selection of frame name
  let frm_grp_content=document.getElementById('frm_grp').children;
  let frm_grp_id=[];
  let frm_set_name='Frameeg'+(frm_grp_content.length+1);
  for (i = 0; i < frm_grp_content.length; i++) {
    frm_grp_id[i]=frm_grp_content[i].getAttribute('id');
  }
  frm_grp_id.sort();
  for(i=0;i<frm_grp_content.length;i++){
    if(frm_grp_id[i]!='Frameeg'+(i+1)){
      frm_set_name='Frameeg'+(i+1);
      break;
    }
  }

  //creation of new file
  let btn = document.createElement("button");
  btn.setAttribute("class","tablink");
  btn.setAttribute("onclick","openPage('"+frm_set_name+"', this)");
  btn.setAttribute("onmouseover","closebtndis(this)");
  btn.setAttribute("onmouseout","closebtnin(this)");

  let name_split=args.split("\\");
  if(name_split.length==1){
    btn.innerHTML="untitled." +args;
  }
  else{
    btn.innerHTML= name_split[(name_split.length)-1];
  }

  let sp=document.createElement("span");
  sp.setAttribute("onclick","closePage('"+frm_set_name+"',this)");
  sp.setAttribute("class","closebtn");
  sp.innerHTML="X";

  btn.appendChild(sp);
  document.getElementById("btn_grp").appendChild(btn);

  let div_frm=document.createElement("div");
  div_frm.setAttribute("id",frm_set_name);
  div_frm.setAttribute("class","tabcontent");

  let ifrm=document.createElement("iframe");
  ifrm.setAttribute("src","coding_area.html");

  div_frm.appendChild(ifrm);
  document.getElementById('frm_grp').appendChild(div_frm);

  btn.click();
});

//openFile
  ipcRenderer.on('openFile', function(event,args){
    selectCurrentTab();
    setTimeout(() => {
      ifrm_contentWindow.showData(args);
    }, 100);
  });

//saveFile
  ipcRenderer.on('saveFile', function(event,args){
    selectCurrentTab();
    let saveText=ifrm_contentWindow.getData(args);
    ipcRenderer.send('saveData',saveText);
  });

//saveFileisalreadysaved
  ipcRenderer.on('isFileSaved', function(event,args){
    selectCurrentTab();
    let bool_isFileSaved=ifrm_contentWindow.getFileName();
    ipcRenderer.send('bool_val',bool_isFileSaved);
  });

  var ifrm_contentWindow;
  function selectCurrentTab(){
    let tabcontent=document.getElementsByClassName("tabcontent");
    let currentArea;
    for(i=0;i<tabcontent.length;i++){
      if(tabcontent[i].style.display=="block"){
        currentArea=tabcontent[i].getAttribute('id');//frameeg+(i+1)
        break;
      }
    }
    let ifrm=document.getElementById(currentArea).children[0];
    ifrm_contentWindow=ifrm.contentWindow;
  }
</script>

</body>
</html>
